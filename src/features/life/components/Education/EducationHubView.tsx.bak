import React from 'react';
import {
    View,
    Text,
    TouchableOpacity,
    StyleSheet,
    ScrollView,
    SafeAreaView
} from 'react-native';
import { useEducationSystem } from './useEducationSystem';
import { DEGREE_DATA } from './educationData';

// ========================================
// TYPES
// ========================================

interface EducationHubViewProps {
    onNavigate: (view: 'CLUBS' | 'PROGRAMS' | 'TRANSCRIPT') => void;
    onStudy: () => void;
}

// ========================================
// COMPONENT
// ========================================

export const EducationHubView: React.FC<EducationHubViewProps> = ({ onNavigate, onStudy }) => {
    const { currentEnrollment, salaryMultiplier } = useEducationSystem();

    const renderEnrollmentStatus = () => {
        if (!currentEnrollment) {
            return (
                <View style={styles.statusCard}>
                    <Text style={styles.statusTitle}>üìö Academic Status</Text>
                    <Text style={styles.notEnrolledText}>Not Enrolled</Text>
                    <Text style={styles.statusHint}>Visit Academic Programs to enroll</Text>
                </View>
            );
        }

        const { major, type, progress, totalDuration } = currentEnrollment;
        const currentYear = Math.ceil(progress / 4);
        const totalYears = Math.ceil(totalDuration / 4);
        const progressPercentage = (progress / totalDuration) * 100;

        return (
            <View style={styles.statusCard}>
                <Text style={styles.statusTitle}>üìö Academic Status</Text>
                <View style={styles.enrollmentInfo}>
                    <Text style={styles.majorText}>{major}</Text>
                    <Text style={styles.degreeText}>{type}</Text>
                </View>
                <View style={styles.progressSection}>
                    <View style={styles.progressHeader}>
                        <Text style={styles.progressLabel}>Year {currentYear} of {totalYears}</Text>
                        <Text style={styles.progressPercent}>{Math.round(progressPercentage)}%</Text>
                    </View>
                    <View style={styles.progressBarContainer}>
                        <View style={[styles.progressBar, { width: `${progressPercentage}%` }]} />
                    </View>
                    <Text style={styles.quarterText}>Quarter {progress} / {totalDuration}</Text>
                </View>
            </View>
        );
    };

    const menuItems = [
        {
            id: 'LIBRARY',
            title: 'Library',
            icon: 'üìö',
            subtitle: '+3 Intellect',
            action: onStudy,
        },
        {
            id: 'CLUBS',
            title: 'Student Clubs',
            icon: 'ü§ù',
            subtitle: 'Join Elite Societies',
            action: () => onNavigate('CLUBS'),
        },
        {
            id: 'PROGRAMS',
            title: 'Academic Programs',
            icon: 'üéì',
            subtitle: 'Enroll in Degrees',
            action: () => onNavigate('PROGRAMS'),
        },
        {
            id: 'TRANSCRIPT',
            title: 'Transcript',
            icon: 'üìú',
            subtitle: `Salary Multiplier: ${salaryMultiplier()}x`,
            action: () => onNavigate('TRANSCRIPT'),
        },
    ];

    return (
        <View style={styles.container}>
            <SafeAreaView style={styles.safeArea}>
                <ScrollView contentContainerStyle={styles.scrollContent} showsVerticalScrollIndicator={false}>
                    {/* Header */}
                    <View style={styles.header}>
                        <Text style={styles.headerTitle}>üèõÔ∏è Ivy League University</Text>
                        <Text style={styles.headerSubtitle}>Excellence in Education</Text>
                    </View>

                    {/* Current Status */}
                    {renderEnrollmentStatus()}

                    {/* Grid Menu */}
                    <View style={styles.gridContainer}>
                        {menuItems.map((item, index) => (
                            <TouchableOpacity
                                key={item.id}
                                style={styles.gridItem}
                                onPress={item.action}
                                activeOpacity={0.7}
                            >
                                <Text style={styles.gridIcon}>{item.icon}</Text>
                                <Text style={styles.gridTitle}>{item.title}</Text>
                                <Text style={styles.gridSubtitle}>{item.subtitle}</Text>
                            </TouchableOpacity>
                        ))}
                    </View>
                </ScrollView>
            </SafeAreaView>
        </View>
    );
};

// ========================================
// STYLES
// ========================================

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#f8f9fa',
    },
    safeArea: {
        flex: 1,
    },
    scrollContent: {
        padding: 20,
        paddingBottom: 40,
    },
    header: {
        alignItems: 'center',
        marginBottom: 24,
        paddingBottom: 16,
        borderBottomWidth: 2,
        borderBottomColor: '#d4af37',
    },
    headerTitle: {
        fontSize: 26,
        fontWeight: 'bold',
        color: '#1e3a8a',
        marginBottom: 4,
        textAlign: 'center',
    },
    headerSubtitle: {
        fontSize: 14,
        color: '#6b7280',
        fontStyle: 'italic',
    },
    statusCard: {
        backgroundColor: '#ffffff',
        borderRadius: 16,
        padding: 20,
        marginBottom: 24,
        borderWidth: 2,
        borderColor: '#1e3a8a',
        shadowColor: '#000',
        shadowOffset: { width: 0, height: 2 },
        shadowOpacity: 0.1,
        shadowRadius: 4,
        elevation: 3,
    },
    statusTitle: {
        fontSize: 18,
        fontWeight: 'bold',
        color: '#1e3a8a',
        marginBottom: 12,
    },
    notEnrolledText: {
        fontSize: 16,
        color: '#6b7280',
        fontWeight: '600',
        marginBottom: 8,
    },
    statusHint: {
        fontSize: 14,
        color: '#9ca3af',
        fontStyle: 'italic',
    },
    enrollmentInfo: {
        marginBottom: 16,
    },
    majorText: {
        fontSize: 20,
        fontWeight: 'bold',
        color: '#1f2937',
        marginBottom: 4,
    },
    degreeText: {
        fontSize: 16,
        color: '#6b7280',
        fontWeight: '600',
    },
    progressSection: {
        marginTop: 8,
    },
    progressHeader: {
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems: 'center',
        marginBottom: 8,
    },
    progressLabel: {
        fontSize: 14,
        fontWeight: '600',
        color: '#374151',
    },
    progressPercent: {
        fontSize: 14,
        fontWeight: 'bold',
        color: '#1e3a8a',
    },
    progressBarContainer: {
        height: 12,
        backgroundColor: '#e5e7eb',
        borderRadius: 6,
        overflow: 'hidden',
        marginBottom: 6,
    },
    progressBar: {
        height: '100%',
        backgroundColor: '#1e3a8a',
        borderRadius: 6,
    },
    quarterText: {
        fontSize: 12,
        color: '#9ca3af',
        textAlign: 'right',
    },
    gridContainer: {
        flexDirection: 'row',
        flexWrap: 'wrap',
        justifyContent: 'space-between',
        gap: 16,
    },
    gridItem: {
        width: '47%',
        backgroundColor: '#ffffff',
        borderRadius: 16,
        padding: 20,
        alignItems: 'center',
        borderWidth: 2,
        borderColor: '#e5e7eb',
        shadowColor: '#000',
        shadowOffset: { width: 0, height: 2 },
        shadowOpacity: 0.1,
        shadowRadius: 4,
        elevation: 2,
    },
    gridIcon: {
        fontSize: 40,
        marginBottom: 12,
    },
    gridTitle: {
        fontSize: 16,
        fontWeight: 'bold',
        color: '#1f2937',
        marginBottom: 6,
        textAlign: 'center',
    },
    gridSubtitle: {
        fontSize: 12,
        color: '#6b7280',
        textAlign: 'center',
    },
});
